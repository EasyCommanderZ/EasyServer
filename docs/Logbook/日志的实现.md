# 日志库实现

具体的实现思路和实现分析写到了modules下面，此处只是做一些零碎的记录。

---

首先想要参考 ZLToolKit 的日志库，但是看了一下感觉实现比较复杂，而且代码都在一个文件里，不太好阅读和理解，遂转向另外一位 github@linyacool 开发的类 muduo 的server中的日志库，以及 TinyWebserver 及其 C++ 11 中实现的日志库，有基础功能，也比较好实现。

但是想起hxd蒋哥前段时间借鉴其他人的日志库自己实现了一个轻量级的日志库[TinyLog](https://github.com/CsJsss/TinyLog)，于是决定参照他的repo，只需要其中最基本的日志功能的实现即可，不懂还可以问问他，岂不美哉。

---

在研究了一段时间之后，发现日志模块的整体实现并不简单。封装的类比较多，从底向上依次是：

1. 文件读写类
2. 对文件读写类封装一个日志文件的读写类；
3. 封装缓冲区类、日志文件配置类
4. 实现同步、异步日志类
5. 封装接口类

感觉不仔细实现一遍没办法搞懂。。。其中的不少设计都比较巧妙。

---

日志库的具体结构见modules下面的[记录文档](../Modules/Log.md)。在Log中，主要分为三个部分：

1. 基本的文件写入类；
2. Log的前端，负责产生日志
3. Log的后端，负责写入日志到本地文件

另外，还封装了一个LogBuffer类，对于C-style的字符缓冲进行简单封装，并提供了一些方便的方法，可以快速的获取缓冲的长度，内容等信息，也对写入进行了简单的检查等。

异步日志中的缓冲区是一个双向链表组织起来的线性缓冲区。在不足的时候会自动申请新的缓冲节点加入到队列中。在析构函数里面也进行了解引用防止内存泄漏。s
